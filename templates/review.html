{%  extends 'base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-inner-large">
                    <div class="image-container">
                        <img src="{{ review.image.url }}" class="card-img-top" alt="image of {{ review.name }}">
                    </div>
                    
                    <div class="card-body">
                        <h5 class="card-title">{{ review.name }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">{{ review.description }}</h6>
                        <p>
                            By: {{ review.author }}
                        </p>
                        <!-- <p>
                            Author ID: {{ review.author.id }}
                        </p>
                        <p>
                            Current user ID: {{ user.id }}
                        </p> -->
                        <p>
                            {{ review.created_on }}
                        </p>
                        <p class="card-text">
                            {{ review.content |safe }}
                        </p>
                        <div>
                            {% if user.is_authenticated %}
                                <form action="{% url 'review_upvote' review.pk %}" method="POST">

                                    {% csrf_token %}
                                    
                                    {% if upvoted %}
                                        <button type="submit" name="review_id" value="{{ review.pk }}" class="">
                                            <i class="fas fa-thumbs-up"></i>
                                        </button>
                                    {% else %}
                                        <button type="submit" name="review_id" value="{{ review.pk }}" class="">
                                            <i class="far fa-thumbs-up"></i>
                                        </button>    

                                    {%  endif %}
                                </form>
                            {% else %}
                                <i class="far fa-thumbs-up"></i>

                            {% endif %}

                            <span>{{ review.review_upvotes }}</span>
                        </div>
                        <div>
                            {% if user.is_authenticated %}
                                <form action="{% url 'review_downvote' review.pk %}" method="POST">

                                    {% csrf_token %}
                                    
                                    {% if downvoted %}
                                        <button type="submit" name="beer_review_id" value="{{ review.pk }}" class="">
                                            <i class="fas fa-thumbs-down"></i>
                                        </button>
                                    {% else %}
                                        <button type="submit" name="beer_review_id" value="{{ review.pk }}" class="">
                                            <i class="far fa-thumbs-down"></i>
                                        </button>    

                                    {%  endif %}
                                </form>
                            {% else %}
                                <i class="far fa-thumbs-down"></i>

                            {% endif %}

                            <span>{{ review.review_downvotes }}</span>
                        </div>

                        <div>
                            {% with comments.count as total_comments %}
                                <strong class="text-secondary"><i class="far fa-comments"></i>
                                    {{ total_comments }}
                                </strong>
                            {% endwith %}
                        </div>
                        <div class="row">
                            <div class="col card mb-4 mt-3">
                                <h3>Comments:</h3>
                                <div class="card-body">
                                    {% for comment in comments %}
                                        <div class="comments" style="padding: 10px;">
                                            <p class="font-weight-bold">
                                                {{ comment.author }}
                                                <span class=" text-muted font-weight-normal">
                                                    {{ comment.timestamp }}
                                                </span>
                                                wrote:
                                            </p>
                                            {{ comment.content | linebreaks }}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>    
                        <div class="row">
                            <div class="col mb-4 mt-3 ">
                                {% if commented %}
                                <div class="alert alert-success" role="alert">
                                    Your comment has been submitted and is awaiting approval
                                </div>
                                {% else %}
                                    {% if user.is_authenticated %}
                                        <h3>
                                            Leave a comment:
                                        </h3>
                                        <p>
                                            Posting as: {{ user.username }}
                                        </p>
                                        <form method="POST" style="margin-top: 1.3em;">
                                            {{ comment_form.media }}
                                            {{ comment_form.as_p }}
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-signup btn-lg">Submit</button>
                                        </form>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            {% if user.is_authenticated %}
                                {% if user.id == review.author.id %}
                                    <div>
                                        This is your beer review, so you may update or delete it using the buttons below
                                    </div>
                                {% else %}
                                    <div>
                                        You are not the author of this post, so you may not update or delete it
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                        <div class="row">
                            <div>
                                <a class="btn" href="{% url 'home' %}">Back</a>
                                {% if user.is_authenticated %}
                                    {% if user.id == review.author.id %}
                                        <a class="btn" href="{% url 'update_review' review.pk %}">Edit</a>
                                        <a class="btn" href="{% url 'delete_review' review.pk %}">Delete</a>
                                    {% endif %}
                                {% endif %}    
                            </div>
                        </div>
                    </div>
                </div>     
            </div>
        </div>
    </div>
</div>

{%  endblock %}